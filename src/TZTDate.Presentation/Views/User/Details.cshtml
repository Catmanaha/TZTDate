@inject UserManager<User> UserManager;
@model User;

@{
    ViewData["Title"] = $"{Model.Username}'s Details";
    var currentUser = await UserManager.GetUserAsync(User);
    var zodiacCompability = currentUser?.CompatibilityByZodiacSign(Model);
    bool repricateMembership;
    bool likeButtonState;
    if(currentUser.FollowedId is not null)
    {
        likeButtonState = currentUser.FollowedId.Contains(Model.Id);
    }
    else
    {
        likeButtonState = false;
    }
    if(Model.FollowedId is not null && currentUser.FollowedId is not null)
    {
        repricateMembership = currentUser.FollowedId.Contains(Model.Id) && Model.FollowedId.Contains(currentUser.Id);
    }
    else
    {
        repricateMembership = false;
    }
    
}

<div class="details-img-div">
    @foreach (var profilePicPath in @Model?.ProfilePicPaths)
    {
        <img src="~/Assets/@profilePicPath" alt="profile-pic">
    }
    @* <a href="/Chat/Chat?id=@Model.Id">Chat Now</a> *@
    <br>
</div>

<div class="details-divs">
    <div class="interests">
        <label><b>My Interests</b></label>
        <p style="margin-top: 20px;">@Model.Interests</p>
    </div>
    <div class="about-me">
        <label><b>About Me</b></label>
        <p style="margin-top: 20px;"><strong>Live in: </strong> @Model.Address</p>
        <p><strong>Name: </strong> @Model.Username</p>
        <p><strong>Email: </strong> @Model.Email</p>
        <p><strong>Gender: </strong> @Model.Gender</p>
    </div>
    <div class="looking-for">
        <label><b>I'm Looking For</b></label>
        <p style="margin-top: 20px;">
            <strong>Searching For Ages Between: </strong>@Model.SearchingAgeStart and
            @Model.SearchingAgeEnd
        </p>
        <p><strong>Searching For: </strong> @Model.SearchingGender</p>
        <p>@Model.Description</p>

    </div>
</div>

<div class="zodiac-entities">
    <h2>Zodiac sign compability</h2>
    <h3><span class="zodiac-sign">@currentUser.GetZodiacSign()</span> @zodiacCompability?.Type <span
            class="zodiac-sign">@Model.GetZodiacSign()</span></h3>
    <div>@zodiacCompability?.Description</div>
</div>



<div class="container-calc-like">
    <div class="relationship-calc-entities">
        <h2 class="">Relationship calculator</h2>
        <vc:RelationshipCalcComponent class="calc-result">
            @await Component.InvokeAsync("RelationshipCalcComponent",
                     Model.Username)
        </vc:RelationshipCalcComponent>
    </div>

    <div>
        <form id="membership-form" asp-controller="User" asp-action="MembershipAction" method="post">
            <input type="hidden" name="userToActionId" value="@Model.Id" />
            <button id="like-button" type="submit" class="like-button @(likeButtonState ? "liked" : "")">
                @(likeButtonState ? "Unlike" : "Like")
            </button>
        </form>
        <form id="" asp-controller="" asp-action="" method="">
            <input type="hidden" name="" value="" />
            <button @(repricateMembership ? "" : "hidden") id="chat-button" type="submit" class="chat-button">
                Chat
            </button>
        </form>
    </div>
</div>

<script>
    const likeButton = document.getElementById('like-button');
    likeButton.addEventListener('click', async (event) => {
        event.preventDefault();

        likeButton.dataset.liked = likeButton.classList.contains('liked') ? 'true' : 'false';
        
        const isLiked = likeButton.dataset.liked === 'true';
        likeButton.dataset.liked = isLiked ? 'false' : 'true';
        
        if (isLiked) {
            likeButton.classList.remove('liked');
            likeButton.textContent = 'Like';
        } else {
            likeButton.classList.add('liked');
            likeButton.textContent = 'Unlike';
        }
        
        const form = document.getElementById('membership-form');
        const formData = new FormData(form);
        const response = await fetch(form.action, {
            method: form.method,
            body: formData
        });
        
        return false;
    });
</script>

<style>
    .details-img-div {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        padding: 20px;
        user-select: none;
    }

    .details-img-div a {
        margin-bottom: 30px;
        margin-top: 18px;
        color: #fff;
        background-color: #346931;
        text-decoration: none;
        width: 400px;
        padding: 5px 15px;
        border-radius: 10px;
        user-select: none;
    }

    .details-img-div a:hover {
        transition: 0.4s ease;
        background-color: #094206;
        user-select: none;
    }

    .details-img-div img {
        width: calc(33.33% - 20px);
        max-height: 300px;
        margin-bottom: 20px;
        object-fit: contain;
        border: 2px solid #ddd;
        border-radius: 5px;
        user-select: none;
    }

    .details-divs {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        user-select: none;
    }

    .interests {
        display: flex;
        flex-direction: column;
        background-color: #ededed;
        border-radius: 20px;
        padding: 50px;
        text-align: center;
        width: 400px;
        user-select: none;
    }

    .looking-for {
        display: flex;
        flex-direction: column;
        background-color: #ededed;
        border-radius: 20px;
        padding: 50px;
        text-align: center;
        width: 400px;
        user-select: none;
    }

    .about-me {
        display: flex;
        flex-direction: column;
        background-color: #ededed;
        border-radius: 20px;
        padding: 50px;
        text-align: center;
        width: 400px;
        user-select: none;
    }

    .details-divs b {
        font-size: 20px;
        user-select: none;
    }

    .zodiac-entities {
        margin-left: 15%;
        margin-top: 20px;
        margin-bottom: 20px;
        background-color: #4CAF50;
        color: white;
        padding: 10px;
        border: none;
        text-align: center;
        display: inline-block;
        font-size: 16px;
        cursor: pointer;
        width: 100%;
        max-width: 70%;
        user-select: none;
        border-radius: 10px;
    }



    .zodiac-entities:hover {
        background-color: #45a049;
    }

    .zodiac-entities h2,
    .zodiac-entities h3 {
        margin: 0;
    }

    .relationship-calc-entities {
        margin-left: 35%;
        margin-bottom: 20px;
        background-color: #4CAF50;
        color: white;
        padding: 10px;
        border: none;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        cursor: pointer;
        width: 100%;
        max-width: 30%;
        pointer-events: none;
        border-radius: 10px;
        user-select: none;
    }

    .calc-result {
        font-size: xx-large;
        color: yellow;
    }

    .chat-button {
        display: inline-block;
        padding: 10px 20px;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        margin: 50%;
        background-color: #17e41b;
        color: #333;
        &:hover {
            background-color: #cfcfcf;
        }
    }

    .like-button {
        display: inline-block;
        padding: 10px 20px;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        margin: 50%;
        background-color: #17e41b;
        color: #333;
        &.liked {
            background-color: #ff4d4d;
            color: #fff;
        }
        &:hover {
            background-color: #cfcfcf;
        }
    }

    .container-calc-like {
        display: flex;
    }

    .zodiac-sign {
        font-weight: 900;
        text-shadow: 4px 4px 8px rgba(255, 0, 0, 0.7);
        font-style: italic;
        color: red;
    }
</style>